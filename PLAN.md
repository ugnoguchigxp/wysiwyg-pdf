# Bulleted Lists Implementation Plan

## Goal
テキストオブジェクトに箇条書き（黒丸・番号付き）を追加し、ネスト最大深度5を保証する。

## Scope
- 対象: テキストオブジェクトの編集・表示・保存・再読込・PDF出力
- 対象外: 既存フォーマットの大規模移行や外部インポート仕様の拡張

## Requirements
- 箇条書きの種類: 黒丸（・）、番号付き（1.2.3.）
- ネスト: 最大深度5
- 改行時: 同じレベル・同じ種別で継続
- 解除: 空行で解除 or 明示操作で解除
- 互換: 既存テキストは通常段落として維持
- 縦書き: 箇条書きは階層を持たない（常に level=1）
- 番号付き: 階層ごとに独立採番
- ペースト: 文字としての貼り付けは可能だが、箇条書き情報は維持しない
- マーカー（・/1.）の開始位置は本文から文字半分程度インデント
- 箇条書き開始はプロパティパネルのボタン押下（・/1. の2種類）
- 改行2つで箇条書きモード終了
- ネスト深度5超は作成されない（6つ目が出てこない）

## Open Questions (決める必要がある)
- なし

## System Survey (作業手順)
1) テキストオブジェクトのデータモデルを確認
2) レンダリング経路（Canvas/DOM/PDF）を確認
3) エディタの操作系（ツールバー/ショートカット）を確認
4) シリアライズ/デシリアライズ形式を確認
成果物: 影響範囲一覧（ファイルパスと責務）

## Design Proposal (実装前に確定)
### Data Model
- 既存の段落/ラン構造に `list` 属性を追加
  - `list.type`: "bullet" | "number"
  - `list.level`: 1..5
  - `list.index`: number (番号付きの場合のみ)
- 互換性: `list` が無い場合は通常段落

### Editing Behavior
- 箇条書きのトグル: 段落単位で on/off
- Enter: 同じ種別・同じ level の新段落を作成
- Enter を2回で箇条書きモード終了（通常段落へ）
- Backspace on empty item: 箇条書きを解除して通常段落へ
- Tab/Shift+Tab: level を +1 / -1（1..5にクランプ）
- 深度5でTabしても新しいネストは作られない
- テキスト編集モード時は Tab で階層を作成可能
- 縦書きでは階層操作を無効化（常に level=1）
- ペーストは文字貼り付けのみで、箇条書き変換は行わない

### Rendering
- 黒丸: U+30FB "・" を描画
- 番号付き: level ごとにインデント + “1.” 形式
- インデント幅: level ごとに一定（既存行間・フォントに合わせる）
- マーカーと本文の間隔: 文字半分程度の余白
- 縦書き: 階層なしの箇条書き表示のみ

### Serialization
- JSONに `list` を保存
- 既存データは `list` なしで読み込み
- 縦書きは `list.level=1` のみ許可

## Implementation Steps
1) 影響範囲調査: 対象ファイル一覧を作成
2) データモデル拡張: `list` 属性の型定義とバリデーション追加
3) 編集ロジック: トグル、Enter、Backspace、Tab/Shift+Tabの挙動実装
4) レンダリング: インデント・マーカー描画追加
5) シリアライズ: 保存/再読込の整合性を担保
6) UI: ボタン追加（黒丸・番号付き）

## Tests / Verification
- 深度1〜5の作成・編集・解除
- Enter/Backspace/Tab/Shift+Tab の挙動
- 既存データの読み込み互換性
- 保存→再読込で list が維持される
- PDF出力の位置ずれや崩れが無い
- 縦書きで階層が作られないこと
- 深度5でTabしても6つ目が作られないこと

## Risks
- 既存テキストの段落構造が単純でない場合、list付与が崩れる可能性
- PDF出力と画面描画でインデント計算がずれる可能性
- 縦書きの箇条書き表示が横書きと同じレイアウト前提だと崩れる可能性
